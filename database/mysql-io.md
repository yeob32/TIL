# MySQL I/O

## 메모리 I/O, 디스크 I/O
- 메모리 I/O
  - 전기적 신호
- 디스크 I/O
  - 디스크의 엑세스 암이 움직이면서 헤드를 통해 데이터를 읽고 씀
- 메모리는 물리적으로 한정된 자원, 디스크 I/O 를 최소화하고 버퍼 캐시 효율을 높이는 것이 데이터베이스 I/O 튜닝의 목표가 된다.

## HDD(하드 디스크 드라이버), SSD(솔리드 스테이트 드라이브)
- SSD
  - 하드 디스크 드라이브에서 데이터 저장용 플래터(원판)을 제거하고, 그 대신 NAND 플래시 메모리를 장착
    - 플래시 메모리는 전원이 공급되지 않아도 데이터가 삭제되지 않음
  - 디스크 원판을 기계적으로 회전시킬 필요가 없어졌기 때문에 HDD 에 비해 아주 빨리 데이터를 읽고 쓸 수 있음
  - 요즘은 데이터베이스 서버에서 SSD 를 많이 채택함
    - 데이터베이스는 순차 I/O 보다 랜덤 I/O 작업이 더 많기 때문에 SSD 가 적합
    - 디스크의 헤더를 움직이지 않고, 한 번에 많은 데이터를 읽는 순차 I/O 에서는 SSD 가 HDD 보다 조금 빠르거나 거의 비슷한 성능을 보임
    - 랜덤 I/O 에서는 HDD 보다 성능이 훨씬 뛰어남

## Random I/O, Sequential I/O
- HDD 의 플래터(원판)을 돌려서 읽어야 할 데이터가 저장된 위치로 디스크 헤더를 이동시킨 다음 데이터를 읽는 것을 의미 
- 디스크 헤더를 움직이는 시간은 디스크에 데이터를 쓰고 읽는데 걸리는 시간에서 가장 많이 차지하는 시간으로 병목이 되는 부분임
  - 여러 번 쓰기,읽기를 요청하는 Random I/O 작업이 훨씬 부하가 크다.
- SSD 에서도 디스크 원판이 없지만, Sequential I/O 보다 Random I/O 의 처리율이 떨어짐
  - 물리적으로 NAND 플래시 메모리에 저장된 데이터를 직접 읽고 쓰는 것이 아니라, 내부적으로 논리적인 주소를 물리적인 주소로 매핑하는 매핑 테이블을 사용
  - 매핑 테이블을 업데이트하려면 NAND 플래시 메모리의 물리적인 위치를 찾아가야 하므로 Random I/O의 경우에는 이 과정이 추가로 발생하여 전체 처리율이 떨어지게 됨 
  - 만약 Sequential I/O 라면, 논리적인 위치를 통해 알아낸 물리적인 위치를 이용해 나머지 항목들도 업데이트해주면 됨
- Random I/O
  - 데이터를 임의의 위치에서 읽거나 쓰는 작업
  - 디스크 헤더를 데이터의 개수만큼 움직여야함
    - 디스크 헤더가 여러 위치로 이동해야하기 때문에 비교적 느린 작업이며, 자주 발생 시 성능 저하
  - 발생 상황
    - 인덱스 레인지 스캔(Index Range Scan) 
    - 특정 레코드나 데이터 블록을 찾기 위해 인덱스를 탐색하는 경우
    - WHERE 절에 조건을 포함한 쿼리를 실행하여 특정 레코드를 찾는 경우
    - 임의의 데이터 위치에 대한 갱신 또는 삭제 작업을 수행하는 경우
- Sequential I/O
  - 데이터를 연속적인 블록으로 순차적으로 읽거나 쓰는 작업
  - 디스크 헤드를 한 번만 움직임
    - 연속적인 데이터를 읽거나 쓰기 때문에 Random I/O 에 비해 빠름, 대량의 데이터 엑세스 작업에 유리
  - 발생 상황
    - 풀 테이블 스캔(Full Table Scan)
      - 큰 테이블의 레코드 대부분을 읽는 작업에서는 인덱스를 사용하지 않고 풀 테이블 스캔을 사용하도록 옵티마이저가 유도하기도함
    - 테이블의 모든 레코드를 스캔하는 SELECT 쿼리를 실행하는 경우
    - 인덱스의 모든 블록을 읽거나 쓰는 경우
    - 대량의 데이터를 정렬하거나 그룹화하는 경우

## I/O 튜닝의 핵심 원리
- 일반적으로 쿼리 튜닝하는 것은 Sequential 엑세스에 의한 선택 비중을 높이고 Random 엑세스 자체를 줄이는 것이 목적
  - 쿼리를 처리하는데 꼭 필요한 데이터만을 읽고 쓰도록 쿼리를 개선하는 것
  - Sequential 엑세스에 의한 선택 비중 증가
    - 테이블을 스캔하면서 읽은 레코드 중 대부분 필터링되고 일부분만 선택된다면 인덱스를 사용하는 것이 효과적
  - Sequential 엑세스 발생량 감소
    - 인덱스에 속하지 않은 컬럼을 조건절로 두거나 SELECT 하게 되면 Table Access 가 발생한다. 인덱스를 조정함으로써 이러한 Random 엑세스 횟수를 줄일 수 있음
- 쿼리의 성능 향상 방법으로 가능한한 Sequential I/O 를 증가시키고, Random I/O 를 최소화하는 것이 최적의 해결이 되긴한다.
하지만, 쿼리를 튜닝해서 Random I/O 를 Sequential I/O 로 바꿔서 실행할 방법은 그리 많지 않음