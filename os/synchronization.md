# 프로세스 동기화

- 협력하는 프로세스들 사이의 실행 순서 규칙 보장
- 공유 자원 일관성(consistency) 보장

## 임계 영역 (Critical Section)
- 여러 프로세스나 스레드 등의 처리 단위가 동시에 접근해서는 안되는 공유 영역

```
do {
    wait(mutex); // 입장 영역(entry section)

    임계 영역

    signal(mutex); // 퇴장 영역(exit section)

    나머지 영역(remainder section)
}
```

### 임계 영역 문제
- 임계 영역에 두 처리 단위가 동시에 접근 할 때 발생하는 문제

### 관련 문제
- 입출금 문제
- 생산자-소비자 문제
- 독자-저자 문제

### 해결 조건
> 임계 구역 문제를 해결하기 위해서는 다음 3가지 조건을 충족해야 한다.
- 상호 배제(Mutual exclusion)
    - 하나의 프로세스가 임계 구역에 들어가 있다면 다른 프로세스는 들어갈 수 없어야 한다.
- 진행(Progress)
    - 임계 구역에 들어간 프로세스가 없는 상태에서, 들어가려고 하는 프로세스가 여러 개 있다면 어느 것이 들어갈지를 적절히 결정해주어야 한다.
- 한정 대기(Bounded waiting)
    - 다른 프로세스의 기아(Starvation)를 방지하기 위해, 한 번 임계 구역에 들어간 프로세스는 다음 번 임계 구역에 들어갈 때 제한을 두어야 한다.

### 해결 방법
- 소프트웨어
    - 피터슨의 알고리즘
- 하드웨어
    - 세마포어
    - 모니터

## 동기화 기법
### 뮤텍스 (Mutex)
- 상호 배제(`Mut`ual `Ex`clusion) 줄여서 `Mutex`
- 두 처리 단위가 임계 영역에 동시에 접근하지 못하도록 막는 기법
- 즉, 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다는 의미
- 단순 구현
    - lock
        - 현재의 임계 영역에 들어갈 권한을 얻어온다. 
        - 만일 다른 프로세스/스레드가 임계 영역을 수행 중이라면 종료할때까지 대기한다(entry section).
    - unlock
        - 현재의 임계 영역을 모두 사용했음을 알린다. 
        - 대기중인 다른 프로세스/스레드가 임계 영역에 진입할 수 있다(exit section).

### 세마포어 (Semaphore)
- 원자적으로 제어되는 정수 변수
- 여러 프로세스나 스레드가 공유 자원에 접근하는 것을 제어하기 위한 방법
- 일반적으로 세마포어의 값이 0이면 자원에 접근할 수 없도록 블럭을 하고 0보다 크면 접근함과 동시에 세마포어의 값을 1 감소시킨다.
- 종류
    - 계수 세마포어 (counting semaphore)
        - 초기값은 가능한 자원의 수로 정해진다.
        - 값의 범위는 정해져 있지 않다.
    - 이진 세마포어 (binary semaphore)
        - 0 또는 1
- 싱글톤 패턴은 일종의 세마포어를 활용한 공유 자원 관리 기법

### 세마포어, 뮤텍스 차이
- 관리하는 동기화 대상의 개수
- 뮤텍스는 동기화 대상이 오직 하나 뿐일 때
- 세마포어는 동기화 대상이 하나 이상일 때

### 모니터 (Monitor)
- 프로세스 또는 스레드를 동기화하는 방법
- 고급 언어의 설계 구조물로서, 개발자의 코드를 상호배제 하게끔 만든 추상화된 데이터 형태
- 한번에 하나의 프로세스만 모니터에서 활동하도록 보장
- 자바의 스레드 관련 라이브러리와 그 기능(wait, join, notify 등)

### Lock
- 하드웨어 기반 해결책
- 동시에 공유 자원에 접근하는 것을 막기 위해 Critical Section 에 진입하는 프로세스는 Lock 을 획득하고 Critical Section 을 빠져나올 때, Lock 을 방출함으로써 동시에 접근이 되지 않도록 한다.


## 참고
- https://namu.wiki/w/뮤텍스